<html>
    <div>
        <button id="t1" onclick="better(1)"></button>
        <button id="t2" onclick="better(2)"></button>
        <button id="u1" onclick="better(-1)"></button>
        <button id="u2" onclick="better(-2)"></button>
        <button id="u" onclick="better(-0)"></button>
    </div>
    <div>
        <p id="output" style="font-family: monospace; white-space: pre;">
        </p>
        <p id="temp" style="font-family: monospace; white-space: pre; color:darkgray; ">
        </p>
    </div>
    <script>
        let selects = 0;
        let comparisons = 0;
        let skips = 0;
        let pair = null;
        let seen = new Set();

        class SortNode {
            lower = new Set();
            higher = new Set();
            same = new Set();
            unknown = false;
            known = false;

            constructor() {
            }

            addSame(n) {
                this.known = true;
                n.known = true;
                this.same.add(n);
                n.same.add(this);
            }

            addHigher(n) {
                this.known = true;
                n.known = true;
                this.higher.add(n);
                n.lower.add(this);
            }

            addLower(n) {
                this.known = true;
                n.known = true;
                this.lower.add(n);
                n.higher.add(this);
            }
        }

        class SortList {
            nodes = new Map();

            constructor() {
            }

            update(i, a, b) {
                let aNode = this.getNode(a);
                let bNode = this.getNode(b);
                if (Object.is(-0, i)) {
                    aNode.unknown = bNode.unknown = true;
                    return;
                }

                if (i === 0) {
                    aNode.addSame(bNode);
                    return;
                }

                if (i === -1) {
                    aNode.unknown = true;
                    return;
                }

                if (i === -2) {
                    bNode.unknown = true;
                    return;
                }

                let result = i * 2 - 3;
                let visited = new Set();
                let stack = [bNode];
                do {
                    let curr = stack.pop();
                    let pre = visited.size;
                    visited.add(curr);
                    let post = visited.size;
                    if (post > pre) {
                        if (result > 0) {
                            aNode.addLower(curr);
                            for (let n in curr.lower) {
                                stack.push(n);
                            }
                        } else {
                            aNode.addHigher(curr);
                            for (let n in curr.higher) {
                                stack.push(n);
                            }
                        }
                    }
                } while (stack.length > 0)
            }

            getNode(title) {
                let n = this.nodes.get(title);
                if (!n) {
                    this.nodes.set(title, n = new SortNode());
                }
                return n;
            }

            resetNode(title) {
                this.nodes.set(title, new SortNode());
            }

            compare(a, b) {
                let aNode = this.getNode(a);
                let bNode = this.getNode(b);
                if (aNode.unknown || bNode.unknown || aNode.same.has(bNode)) {
                    ++skips;
                    return 0;
                }

                if (aNode.higher.has(bNode)) {
                    return -1;
                }

                if (aNode.lower.has(bNode)) {
                    return 1;
                }

                if (!pair) {
                    pair = [a, b];
                }
                return 0;
            }
        }

        let titles = [
            'A New Hope',
            'The Phantom Menace',
            'The Force Awakens',
            'The Fellowship of the Ring'
        ];

        let input = new SortList();

        let show = () => {
            console.log(titles
                .map(title => {
                    let n = input.nodes.get(title);
                    return !n || !n.known
                        ? null
                        : title;
                })
                .filter(title => title));
        }

        let better = i => {
            if (i && pair && pair.length === 2) {
                input.update(i, pair[0], pair[1]);
            }

            comparisons = 0;
            skips = 0;
            pair = null;
            titles.sort((a, b) => input.compare(a, b));

            let sorted = titles
                .map(title => {
                    let n = input.nodes.get(title);
                    return !n || !n.known
                        ? null
                        : title;
                })
                .filter(title => title);
            if (pair) {
                console.log(`which is better [1] ${pair[0]} or [2] ${pair[1]}? (type "better(0)" for neither; negative values for unknowns)`);
                document.getElementById("t1").textContent = "[1] " + pair[0];
                document.getElementById("t2").textContent = "[2] " + pair[1];
                document.getElementById("u1").textContent = "[3] I haven't read " + pair[0];
                document.getElementById("u2").textContent = "[4] I haven't read " + pair[1];
                document.getElementById("u").textContent = "[5] I haven't read either";
                document.getElementById("output").textContent = "click a button";
                document.getElementById("temp").textContent = "\t" + titles.join("\n\t");
            } else {
                show();
                console.log('finished sorting');
                document.getElementById("t1").textContent = "";
                document.getElementById("t2").textContent = "";
                document.getElementById("u1").textContent = "";
                document.getElementById("u2").textContent = "";
                document.getElementById("u").textContent = "";
                document.getElementById("output").textContent = "finished sorting:\n\t" + titles.join("\n\t");
                document.getElementById("temp").textContent = "";
            }
        };

        let reset = title => {
            input.resetNode(title);
        }

        better();

        document.addEventListener('keyup', (e) => {
            switch (e.key) {
                case '1': better(1); break;
                case '2': better(2); break;
                case '3': better(-1); break;
                case '4': better(-2); break;
                case '5': better(-0); break;
            }
        });

    </script>
<html>
